<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/favicon.png"> <title>Check Go Escape Analysis Result in Emacs</title> <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "0550f3275b4a4db8bfeefed116695300"}'></script> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> </ul> </div> <div id=main > <div class=franklin-content > <h1 id=title ><a href="#title" class=header-anchor >Check Go Escape Analysis Result in Emacs</a></h1> <p>Sometimes, you may need zero heap allocation in extremely critical code path &#40;which is rare&#41;.</p> <p>To do that, you can run benchmark with <code>-benchmem</code> or check Go compiler&#39;s escape analysis result.</p> <p>Showing the result in Emacs is easy, you simply define a flycheck checker:</p> <pre><code class="lisp hljs">(<span class=hljs-name >flycheck-define-checker</span> goescape
  <span class=hljs-string >&quot;Check Go escape analysis result&quot;</span>
  <span class=hljs-symbol >:command</span> (<span class=hljs-string >&quot;go&quot;</span> <span class=hljs-string >&quot;build&quot;</span> <span class=hljs-string >&quot;-gcflags=-m&quot;</span> <span class=hljs-string >&quot;./...&quot;</span>)
  <span class=hljs-symbol >:modes</span> go-mode
  <span class=hljs-symbol >:error-patterns</span>
  ((<span class=hljs-name >error</span> line-start
          (<span class=hljs-name >file-name</span>) <span class=hljs-string >&quot;:&quot;</span> line <span class=hljs-string >&quot;:&quot;</span> column <span class=hljs-string >&quot;: &quot;</span>
          (<span class=hljs-name >message</span> (<span class=hljs-name >+</span>? nonl) <span class=hljs-string >&quot; escapes to heap&quot;</span>)
          line-end)))</code></pre> <p>Then you can get the result like this:</p> <p><img src="/assets/images/go-escape-in-emacs.png" alt="" /></p> <p>You can also do this in <a href="https://github.com/microsoft/vscode-go/issues/1948#issuecomment-466293994">VS Code</a>.</p> <div class=page-foot > Kauruus <br> <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <br> Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <script src="/libs/highlight/highlight.min.js"></script> <script src="/libs/highlight/languages/lisp.min.js"></script> <script src="/libs/highlight/languages/julia.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>